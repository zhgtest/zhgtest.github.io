<!doctype html><html lang="en" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.4.1" /><meta property="og:title" content="Deploy Ceph cache tier &amp; erasure code" /><meta name="author" content="黃馨平" /><meta property="og:locale" content="en" /><meta name="description" content="本篇文章主要紀錄的是如何應用 cache tier 與 erasure code 在 Cephfs 當中。" /><meta property="og:description" content="本篇文章主要紀錄的是如何應用 cache tier 與 erasure code 在 Cephfs 當中。" /><link rel="canonical" href="https://medium-to-jekyll-starter.zhgchg.li//posts/9132e0ee7018/" /><meta property="og:url" content="https://medium-to-jekyll-starter.zhgchg.li//posts/9132e0ee7018/" /><meta property="og:site_name" content="Medium To Jekyll Starter" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2020-07-10T15:31:51+08:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="Deploy Ceph cache tier &amp; erasure code" /><meta name="twitter:site" content="@twitter_username" /><meta name="twitter:creator" content="@黃馨平" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"黃馨平"},"dateModified":"2020-08-05T16:50:04+08:00","datePublished":"2020-07-10T15:31:51+08:00","description":"本篇文章主要紀錄的是如何應用 cache tier 與 erasure code 在 Cephfs 當中。","headline":"Deploy Ceph cache tier &amp; erasure code","mainEntityOfPage":{"@type":"WebPage","@id":"https://medium-to-jekyll-starter.zhgchg.li//posts/9132e0ee7018/"},"url":"https://medium-to-jekyll-starter.zhgchg.li//posts/9132e0ee7018/"}</script><title>Deploy Ceph cache tier & erasure code | Medium To Jekyll Starter</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="Medium To Jekyll Starter"><meta name="application-name" content="Medium To Jekyll Starter"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="/assets/css/jekyll-theme-chirpy.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.7.1/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.32.2/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/glightbox@3.3.0/dist/css/glightbox.min.css"> <script src="/assets/js/dist/theme.min.js"></script> <script defer src="https://cdn.jsdelivr.net/combine/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js,npm/loading-attribute-polyfill@2.1.1/dist/loading-attribute-polyfill.umd.min.js,npm/glightbox@3.3.0/dist/js/glightbox.min.js,npm/clipboard@2.0.11/dist/clipboard.min.js,npm/dayjs@1.11.13/dayjs.min.js,npm/dayjs@1.11.13/locale/en.js,npm/dayjs@1.11.13/plugin/relativeTime.js,npm/dayjs@1.11.13/plugin/localizedFormat.js,npm/tocbot@4.32.2/dist/tocbot.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script defer src="/app.min.js?baseurl=&register=true" ></script><body><aside aria-label="Sidebar" id="sidebar" class="d-flex flex-column align-items-end"><header class="profile-wrapper"> <a href="/" id="avatar" class="rounded-circle"><img src="/assets/img/avatar.png" width="112" height="112" alt="avatar" onerror="this.style.display='none'"></a> <a class="site-title d-block" href="/">Medium To Jekyll Starter</a><p class="site-subtitle fst-italic mb-0">A text-focused Jekyll theme</p></header><nav class="flex-column flex-grow-1 w-100 ps-0"><ul class="nav"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle"></i> <span>ABOUT</span> </a></ul></nav><div class="sidebar-bottom d-flex flex-wrap align-items-center w-100"> <button type="button" class="btn btn-link nav-link" aria-label="Switch Mode" id="mode-toggle"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/github_username" aria-label="github" target="_blank" rel="noopener noreferrer" > <i class="fab fa-github"></i> </a> <a href="https://twitter.com/twitter_username" aria-label="twitter" target="_blank" rel="noopener noreferrer" > <i class="fa-brands fa-x-twitter"></i> </a> <a href="javascript:location.href = 'mailto:' + ['example','domain.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></aside><div id="main-wrapper" class="d-flex justify-content-center"><div class="container d-flex flex-column px-xxl-5"><header id="topbar-wrapper" aria-label="Top Bar"><div id="topbar" class="d-flex align-items-center justify-content-between px-lg-3 h-100" ><nav id="breadcrumb" aria-label="Breadcrumb"> <span> <a href="/">Home</a> </span> <span>Deploy Ceph cache tier & erasure code</span></nav><button type="button" id="sidebar-trigger" class="btn btn-link"> <i class="fas fa-bars fa-fw"></i> </button><div id="topbar-title"> Post</div><button type="button" id="search-trigger" class="btn btn-link"> <i class="fas fa-search fa-fw"></i> </button> <search id="search" class="align-items-center ms-3 ms-lg-0"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..." > </search> <button type="button" class="btn btn-link text-decoration-none" id="search-cancel">Cancel</button></div></header><div class="row flex-grow-1"><main aria-label="Main Content" class="col-12 col-lg-11 col-xl-9 px-md-4"><article class="px-1" data-toc="true"><header><h1 data-toc-skip>Deploy Ceph cache tier & erasure code</h1><p class="post-desc fw-light mb-4">本篇文章主要紀錄的是如何應用 cache tier 與 erasure code 在 Cephfs 當中。</p><div class="post-meta text-muted"> <span> Posted <time data-ts="1594366311" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Jul 10, 2020 </time> </span> <span> Updated <time data-ts="1596617404" data-df="ll" data-bs-toggle="tooltip" data-bs-placement="bottom" > Aug 5, 2020 </time> </span><div class="d-flex justify-content-between"> <span> By <em> </em> </span><div> <span class="readtime" data-bs-toggle="tooltip" data-bs-placement="bottom" title="1194 words" > <em>6 min</em> read</span></div></div></div></header><div id="toc-bar" class="d-flex align-items-center justify-content-between invisible"> <span class="label text-truncate">Deploy Ceph cache tier & erasure code</span> <button type="button" class="toc-trigger btn me-1"> <i class="fa-solid fa-list-ul fa-fw"></i> </button></div><button id="toc-solo-trigger" type="button" class="toc-trigger btn btn-outline-secondary btn-sm"> <span class="label ps-2 pe-1">Contents</span> <i class="fa-solid fa-angle-right fa-fw"></i> </button> <dialog id="toc-popup" class="p-0"><div class="header d-flex flex-row align-items-center justify-content-between"><div class="label text-truncate py-2 ms-4">Deploy Ceph cache tier & erasure code</div><button id="toc-popup-close" type="button" class="btn mx-1 my-1 opacity-75"> <i class="fas fa-close"></i> </button></div><div id="toc-popup-content" class="px-4 py-3 pb-4"></div></dialog><div class="content"><h3 id="deploy-ceph-cache-tier--erasure-code"><span class="me-2">Deploy Ceph cache tier &amp; erasure code</span><a href="#deploy-ceph-cache-tier--erasure-code" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p><a href="https://miro.medium.com/max/1400/1*e7-XWTx6MvNk_3K1SONq_Q.jpeg" class="popup img-link shimmer"><img src="https://miro.medium.com/max/1400/1*e7-XWTx6MvNk_3K1SONq_Q.jpeg" alt="" loading="lazy"></a></p><p>本篇文章主要紀錄的是如何應用 cache tier 與 erasure code 在 Cephfs 當中。</p><p>本篇文章將會分 4 個部分撰寫： 1. 建立 cache pool，撰寫 crush map rule 將 SSD 與 HDD 分開。 2. 將 cephfs pool 建立 ，並使用 erasure code 與 HDD rule. 3. 將 cache tier 與 cephfs pool 合併。 4. 刪除 cache tier 與 cephfs 。</p><h3 id="step-1"><span class="me-2">Step 1.</span><a href="#step-1" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>撰寫 crush map 將 SSD 與 HDD 分開</p><ul><li>Check SDD 與 HDD 的 OSD.ID 編號</ul><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>ceph osd tree | grep hdd
ceph osd tree | grep ssd
</pre></table></code></div></div><ul><li>先將 crush map decode</ul><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>ceph osd getcrushmap -o crushmapdump
crushtool -d crushmapdump -o crushmapdump-decompiled
</pre></table></code></div></div><ul><li>vim crushmapdump-decompiled 開始撰寫 rule。</ul><p>第一步區分 SSD block 跟 HDD block</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre>root ssd {
        id -40          # do not change unnecessarily
        # weight 0.546
        alg straw2
        hash 0  # rjenkins1
        item osd.6 weight 0.182
        item osd.7 weight 0.182
        item osd.8 weight 0.182
}
</pre></table></code></div></div><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
</pre><td class="rouge-code"><pre>root sata {
        id -41          # do not change unnecessarily
        # weight 20.019
        alg straw2
        hash 0  # rjenkins1
        item osd.0 weight 0.455
        item osd.1 weight 0.455
        item osd.2 weight 0.455
        item osd.3 weight 0.455
        item osd.4 weight 0.455
        item osd.5 weight 0.455
        item osd.9 weight 0.455
        item osd.10 weight 0.455
        item osd.11 weight 0.455
        item osd.12 weight 0.455
        item osd.13 weight 0.455
        item osd.14 weight 0.455
        item osd.15 weight 0.455
        item osd.16 weight 0.455
        item osd.17 weight 0.455
        item osd.18 weight 0.455
        item osd.19 weight 0.455
        item osd.20 weight 0.455
        item osd.21 weight 0.455
        item osd.22 weight 0.455
        item osd.23 weight 0.455
        item osd.24 weight 0.455
        item osd.25 weight 0.455
        item osd.26 weight 0.455
        item osd.27 weight 0.455
        item osd.28 weight 0.455
        item osd.29 weight 0.455
        item osd.30 weight 0.455
        item osd.31 weight 0.455
        item osd.32 weight 0.455
        item osd.33 weight 0.455
        item osd.34 weight 0.455
        item osd.36 weight 0.455
        item osd.37 weight 0.455
        item osd.38 weight 0.455
        item osd.39 weight 0.455
        item osd.40 weight 0.455
        item osd.41 weight 0.455
        item osd.42 weight 0.455
        item osd.43 weight 0.455
        item osd.44 weight 0.455
        item osd.45 weight 0.455
        item osd.46 weight 0.455
        item osd.47 weight 0.455
}        
</pre></table></code></div></div><p>第二步撰寫 tier 所需要的 rule。</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre>rule ssd-pool {
        id 1
        type replicated
        min_size 1
        max_size 10
        step take ssd
        step chooseleaf firstn 0 type osd
        step emit
}
rule sata-pool {
        id 2
        type erasure # very import. if you want use erasure. You must set this type.
        min_size 1
        max_size 10
        step take sata
        step chooseleaf firstn 0 type osd
        step emit
}
</pre></table></code></div></div><p>Crush map 都寫完以後 encode 然後 set 到 system 中.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>crushtool -c crushmapdump-decompiled -o crushmapdump-compiled
ceph osd setcrushmap -i crushmapdump-compiled
</pre></table></code></div></div><p>第三步建立 cache-pool</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre># create cache-pool
ceph osd pool create cache-pool 32 32
</pre></table></code></div></div><h3 id="step-2"><span class="me-2">Step 2.</span><a href="#step-2" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>將 cephfs pool 建立 ，並使用 erasure code 與 HDD rule.</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre># 建立 cold storage 的 pool，若不需要 erasure 可以刪除，但在 crush map 也需要更改。
ceph osd pool create cephfs_data 1024 1024 erasure
</pre></table></code></div></div><h3 id="step-3"><span class="me-2">Step 3.</span><a href="#step-3" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>將 cache tier 與 cephfs pool 合併。</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre># 將兩個 pool 合併，cephfs_data 為 cold storage，cache-pool 為 hot storage。
ceph osd tier add cephfs_data cache-pool
# 設定 cache-pool 的模式為 writeback 模式(其實還有readonly 但不推)。
ceph osd tier cache-mode cache-pool writeback
</pre></table></code></div></div><p>因為本篇應用的方法是使用 cephfs 所以接著建立 cephfs。</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre># cephfs 還是需要 metadata 的 pool(雖然用不到)
ceph osd pool create cephfs_metadata 1024 1024
</pre></table></code></div></div><h3 id="完成--"><span class="me-2">完成 ! !</span><a href="#完成--" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>有興趣的可以玩一下，當中也有很多 cache-tier 調優的方法。</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre>ceph osd pool set cache-pool hit_set_type bloom
ceph osd pool set cache-pool hit_set_count 1
ceph osd pool set cache-pool hit_set_period 3000
ceph osd pool set cache-pool target_max_bytes 161061273600
ceph osd pool set cache-pool target_max_objects 1000000
ceph osd pool set cache-pool cache_min_flush_age 600
ceph osd pool set cache-pool cache_min_evict_age 1800
ceph osd pool set cache-pool cache_target_dirty_ratio .6
ceph osd pool set cache-pool cache_target_dirty_high_ratio .7
ceph osd pool set cache-pool cache_target_full_ratio .8
</pre></table></code></div></div><p>另外小 tips 可以透過指令觀察 cache tier 的變化。</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>watch -n1 ceph df 
</pre></table></code></div></div><h3 id="step-4"><span class="me-2">Step 4.</span><a href="#step-4" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>刪除 cache-tier 與 cephfs。</p><p>在做這個步驟時必須十分警慎，不然處理起來會複雜很多，自己實測按照下面的步驟可以減少很多冤枉路。</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre># Check cache-pool 中有沒有 dirty object
ceph df detail
# 如果有 dirty object 請使用，若沒有可忽略，會花一段時間。
rados -p cache-pool cache-flush-evict-all
# 將 writeback 模式先設定成 readproxy，再改成 none 模式，它無法像 readonly 一樣可以直接改成 none 模式。
# ceph osd tier cache-mod cache-pool forward(研究中)
ceph osd tier cache-mode cache-pool readproxy
ceph osd tier cache-mode cache-pool none
</pre></table></code></div></div><ul><li>刪除 cephfs ，因為個人實測無法直接在 tier 刪除 cephfs_data pool 必須先移除 cephfs 才能解除 cache-tier 的相依性。</ul><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre># 關閉 mds
systemctl stop ceph-mds@ceph-007
# 關閉 cephfs
ceph fs fail cephfs
</pre></table></code></div></div><ul><li>移除 cache tier 的 cold-storage 以及 cache tier</ul><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code fa-fw small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre>ceph osd tier remove-overlay cephfs_data
ceph osd tier remove cephfs_data cache-pool
</pre></table></code></div></div><h3 id="結束了--"><span class="me-2">結束了 ! !</span><a href="#結束了--" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>現在大家都回復自由之身了， cold storge pool 的內容都還保存，沒有問題。</p><p>大致上就結束了，有任何問題歡迎討論。</p><p><a href="https://miro.medium.com/max/1400/1*G4p-DfRg6q3RFd9EJFzhLQ.jpeg" class="popup img-link shimmer"><img src="https://miro.medium.com/max/1400/1*G4p-DfRg6q3RFd9EJFzhLQ.jpeg" alt="" loading="lazy"></a></p><h3 id="參考資料-"><span class="me-2">參考資料 :</span><a href="#參考資料-" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><ul><li><a href="https://docs.ceph.com/docs/jewel/rados/operations/cache-tiering/" target="_blank">Ceph 官網</a><li><a href="https://yq.aliyun.com/articles/606731" target="_blank">Cache tier tuning</a><li><a href="https://www.cnblogs.com/breezey/p/11080532.html" target="_blank">管理 cache tier</a><li><a href="https://yq.aliyun.com/articles/606731" target="_blank">cache tier 介紹與基礎教學</a><li><a href="https://documentation.suse.com/zh-cn/ses/5.5/html/ses-all/cha-ceph-tiered.html" target="_blank">SUSE 教學</a></ul><p><em><a href="https://medium.com/jacky-life/deploy-ceph-cache-tier-erasure-code-9132e0ee7018" target="_blank">Post</a> converted from Medium by <a href="https://github.com/ZhgChgLi/ZMediumToMarkdown" target="_blank">ZMediumToMarkdown</a>.</em></p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw me-1"></i> <a href="/categories/jackycsie/">Jackycsie</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw me-1"></i> <a href="/tags/ceph/" class="post-tag no-text-decoration" >ceph</a> <a href="/tags/storage/" class="post-tag no-text-decoration" >storage</a></div><div class=" post-tail-bottom d-flex justify-content-between align-items-center mt-5 pb-2 " ><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author.</div><div class="share-wrapper d-flex align-items-center"> <span class="share-label text-muted">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Deploy%20Ceph%20cache%20tier%20&%20erasure%20code%20-%20Medium%20To%20Jekyll%20Starter&url=https%3A%2F%2Fmedium-to-jekyll-starter.zhgchg.li%2F%2Fposts%2F9132e0ee7018%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Twitter" aria-label="Twitter"> <i class="fa-fw fa-brands fa-square-x-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Deploy%20Ceph%20cache%20tier%20&%20erasure%20code%20-%20Medium%20To%20Jekyll%20Starter&u=https%3A%2F%2Fmedium-to-jekyll-starter.zhgchg.li%2F%2Fposts%2F9132e0ee7018%2F" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Facebook" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=https%3A%2F%2Fmedium-to-jekyll-starter.zhgchg.li%2F%2Fposts%2F9132e0ee7018%2F&text=Deploy%20Ceph%20cache%20tier%20&%20erasure%20code%20-%20Medium%20To%20Jekyll%20Starter" target="_blank" rel="noopener" data-bs-toggle="tooltip" data-bs-placement="top" title="Telegram" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <button id="copy-link" aria-label="Copy link" class="btn small" data-bs-toggle="tooltip" data-bs-placement="top" title="Copy link" data-title-succeed="Link copied successfully!" > <i class="fa-fw fas fa-link pe-none fs-6"></i> </button> </span></div></div></div></article></main><aside aria-label="Panel" id="panel-wrapper" class="col-xl-3 ps-2 text-muted"><div class="access"><section id="access-lastmod"><h2 class="panel-heading">Recently Updated</h2><ul class="content list-unstyled ps-0 pb-1 ms-1 mt-2"><li class="text-truncate lh-lg"> <a href="/posts/6fc300705d47/">How to Learn New Skills Effectively: Work Smarter, Not Harder</a><li class="text-truncate lh-lg"> <a href="/posts/Welcome/">ZMediumToJekyll Starter</a><li class="text-truncate lh-lg"> <a href="/posts/da095b9be519/">AWS 雲端 信義房屋 賣房爬蟲架構</a><li class="text-truncate lh-lg"> <a href="/posts/4a17936aea1a/">AWS 雲端 591 租屋爬蟲架構</a><li class="text-truncate lh-lg"> <a href="/posts/82bebda01507/">AWS EC2 中部署 LLM</a></ul></section><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/tools/">tools</a> <a class="post-tag btn btn-outline-primary" href="/tags/leetcode/">leetcode</a> <a class="post-tag btn btn-outline-primary" href="/tags/ceph/">ceph</a> <a class="post-tag btn btn-outline-primary" href="/tags/python/">python</a> <a class="post-tag btn btn-outline-primary" href="/tags/aws/">aws</a> <a class="post-tag btn btn-outline-primary" href="/tags/gene/">gene</a> <a class="post-tag btn btn-outline-primary" href="/tags/kubernetes/">kubernetes</a> <a class="post-tag btn btn-outline-primary" href="/tags/life/">life</a> <a class="post-tag btn btn-outline-primary" href="/tags/deep-learning/">deep-learning</a> <a class="post-tag btn btn-outline-primary" href="/tags/ecg/">ecg</a></div></section></div><div class="toc-border-cover z-3"></div><section id="toc-wrapper" class="invisible position-sticky ps-0 pe-4 pb-4"><h2 class="panel-heading ps-3 pb-2 mb-0">Contents</h2><nav id="toc"></nav></section></aside></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 px-md-4"><aside id="related-posts" aria-labelledby="related-label"><h3 class="mb-4" id="related-label">Further Reading</h3><nav class="row row-cols-1 row-cols-md-2 row-cols-xl-3 g-4 mb-4"><article class="col"> <a href="/posts/6bbe4aeaf2cf/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1600998502" data-df="ll" > Sep 25, 2020 </time><h4 class="pt-0 my-2">透過 K8S 建立 NFS 服務</h4><div class="text-muted"><p>本文將介紹，透過 kubernetes 建立 NFS 服務， Storage class 會使用 CEPH RBD 做儲存空間。</p></div></div></a></article><article class="col"> <a href="/posts/1999f52a6fb9/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1600245736" data-df="ll" > Sep 16, 2020 </time><h4 class="pt-0 my-2">在 K8S 使用 Rook 安裝 CEPH</h4><div class="text-muted"><p>本文將介紹如何使用 Rook 將 K8S 與 CEPH 連接。</p></div></div></a></article><article class="col"> <a href="/posts/6a4af7a1f208/" class="post-preview card h-100"><div class="card-body"> <time data-ts="1586917756" data-df="ll" > Apr 15, 2020 </time><h4 class="pt-0 my-2">Ubuntu 透過 Ansible 部署 CEPH</h4><div class="text-muted"><p>本篇會介紹如何在 ubuntu system 透過 ceph-ansible 工具安裝一個 ceph 叢集。</p></div></div></a></article></nav></aside><nav class="post-navigation d-flex justify-content-between" aria-label="Post Navigation"> <a href="/posts/c239929d2176/" class="btn btn-outline-primary" aria-label="Older" ><p>MLflow: 紀錄您 Train 步驟的平台</p></a> <a href="/posts/17f4b68ff664/" class="btn btn-outline-primary" aria-label="Newer" ><p>寫點 LeetCode 吧 !</p></a></nav><footer aria-label="Site Info" class=" d-flex flex-column justify-content-center text-muted flex-lg-row justify-content-lg-between align-items-lg-center pb-lg-3 " ><p>© <time>2025</time> <a href="https://twitter.com/username">your_full_name</a>. <span data-bs-toggle="tooltip" data-bs-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author." >Some rights reserved.</span></p><p>Using the <a data-bs-toggle="tooltip" data-bs-placement="top" title="v7.2.4" href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener" >Chirpy</a> theme for <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a>.<br/> Automatically sync posts from Medium with <a href="https://zhgchg.li/posts/en-medium-to-jekyll/" target="_blank">ZhgChg.Li</a>.</p></footer></div></div><div id="search-result-wrapper" class="d-flex justify-content-center d-none"><div class="col-11 content"><div id="search-hints"><section><h2 class="panel-heading">Trending Tags</h2><div class="d-flex flex-wrap mt-3 mb-1 me-3"> <a class="post-tag btn btn-outline-primary" href="/tags/tools/">tools</a> <a class="post-tag btn btn-outline-primary" href="/tags/leetcode/">leetcode</a> <a class="post-tag btn btn-outline-primary" href="/tags/ceph/">ceph</a> <a class="post-tag btn btn-outline-primary" href="/tags/python/">python</a> <a class="post-tag btn btn-outline-primary" href="/tags/aws/">aws</a> <a class="post-tag btn btn-outline-primary" href="/tags/gene/">gene</a> <a class="post-tag btn btn-outline-primary" href="/tags/kubernetes/">kubernetes</a> <a class="post-tag btn btn-outline-primary" href="/tags/life/">life</a> <a class="post-tag btn btn-outline-primary" href="/tags/deep-learning/">deep-learning</a> <a class="post-tag btn btn-outline-primary" href="/tags/ecg/">ecg</a></div></section></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><aside aria-label="Scroll to Top"> <button id="back-to-top" type="button" class="btn btn-lg btn-box-shadow"> <i class="fas fa-angle-up"></i> </button></aside></div><div id="mask" class="d-none position-fixed w-100 h-100 z-1"></div><aside id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-bs-animation="true" data-bs-autohide="false" ><div class="toast-header"> <button type="button" class="btn-close ms-auto" data-bs-dismiss="toast" aria-label="Close" ></button></div><div class="toast-body text-center pt-0"><p class="px-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></aside><script> document.addEventListener('DOMContentLoaded', () => { SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<article class="px-1 px-sm-2 px-lg-4 px-xl-0"><header><h2><a href="{url}">{title}</a></h2><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div></header><p>{snippet}</p></article>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="me-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); }); </script>
